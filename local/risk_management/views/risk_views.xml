<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!--top level menu -->
    <menuitem id="main_menu_risk_management" name="Risks"/>

    <menuitem id="config_menu" name="Configuration" parent="main_menu_risk_management" sequence="100"/>

    <menuitem id="risk_menu" name="Risks" parent="main_menu_risk_management" sequence="10"/>

    <!-- BUSINESS PROCESS I/O -->
    <!-- views-->
    <record model="ir.ui.view" id="process_data_form">
        <field name="name">business_process_data.form</field>
        <field name="model">risk_management.business_process.input_output</field>
        <field name="arch" type="xml">
            <form string="Input/Output">
                <sheet>
                    <div class="oe_button_box" name="button_box" groups="base.group_user">
                        <button class="oe_stat_button" name="attachment_tree_view" type="object" icon="fa-files-o">
                            <field string="Documents" name="doc_count" widget="statinfo"/>
                        </button>
                    </div>
                    <group col="6">
                        <group colspan="4" col="2">
                            <field name="name" placeholder="Name"/>
                        </group>
                        <group colspan="2" col="2" class="oe_read_only">
                            <field name="is_customer_voice"/>
                        </group>
                    </group>
                    <group class="oe_edit_only">
                        <field name="default_partner_cat_parent_id" invisible="1"/>
                        <field name="business_process_id"
                               attrs="{'invisible': [('source_part_cat_id', '!=', False)], 'required': [('source_part_cat_id', '=', False)],}"
                        />
                        <field name="source_part_cat_id"
                               attrs="{'invisible': [('business_process_id', '!=', False)], 'required': [('business_process_id', '=', False)]}"
                               context="{'default_parent_id': default_partner_cat_parent_id}"
                        />
                    </group>
                    <group class="oe_read_only">
                        <field name="origin_id"/>
                    </group>
                    <group>
                        <field name="ref_input_ids" widget="many2many_tags"
                               attrs="{'invisible': [('source_part_cat_id', '!=', False)]}"/>
                        <field name="channel_ids" widget="many2many_tags"/>
                    </group>
                    <notebook>
                        <page string="Description" name="description_page">
                            <field name="description" type="html"/>
                            <div class="oe_clear"/>
                        </page>
                        <page string="Recipients" name="recipient_page">
                            <group>
                                <field name="dest_partner_ids" widget="many2many_tags"
                                       context="{'default_parent_id': default_partner_cat_parent_id}"
                                       attrs="{'invisible': [('source_part_cat_id', '!=', False)]}"/>
                            </group>
                            <group>
                                <field name="user_process_ids" widget="many2many_tags"
                                       options="{'color_field': 'color'}"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="process_input_data_list">
        <field name="name">process_data.tree</field>
        <field name="model">risk_management.business_process.input_output</field>
        <field name="arch" type="xml">
            <tree create="false" edit="false" delete="false">
                <field name="origin_id"/>
                <field name="name"/>
                <field name="is_customer_voice"/>
                <field name="dest_partner_ids" readonly="1" widget="many2many_tags" options="{'color_field': 'color'}"
                       attrs="{'invisible': [('dest_partner_ids', '=', False)]}"/>
                <field name="user_process_ids" readonly="1" widget="many2many_tags" options="{'color_field': 'color'}"
                       attrs="{'invisible': [('user_process_ids', '=', False)]}"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="process_output_data_list">
        <field name="name">process_data.tree</field>
        <field name="model">risk_management.business_process.input_output</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="is_customer_voice"/>
                <field name="dest_partner_ids" widget="many2many_tags" options="{'color_field': 'color'}"
                       attrs="{'invisible': [('dest_partner_ids', '=', False)]}"/>
                <field name="user_process_ids" widget="many2many_tags" options="{'color_field': 'color'}"
                       attrs="{'invisible': [('user_process_ids', '=', False)]}"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="process_data_search">
        <field name="name">process_data.search</field>
        <field name="model">risk_management.business_process.input_output</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="business_process_id" string="Business Process"/>
                <field name="source_part_cat_id" string="Partner Cat."/>
                <field name="description" string="Description"/>
                <filter name="int_provider" string="Internal" domain="[('business_process_id', '!=', False)]"/>
                <filter name="ext_provider" string="External" domain="[('source_part_cat_id', '!=', False)]"/>
                <filter name="client_voice" string="Customer Voice" domain="[('is_customer_voice', '=', True)]"/>
            </search>
        </field>
    </record>

    <!-- actions-->
    <record model="ir.actions.act_window" id="act_business_process_io">
        <field name="name">Business process i/o</field>
        <field name="res_model">risk_management.business_process.input_output</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="process_data_search"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Here, you can create new input/output
            </p>
        </field>
    </record>

    <!-- I/O CHANNELS -->
    <record model="ir.ui.view" id="process_io_channel_form">
        <field name="name">business_process_io.form</field>
        <field name="model">risk_management.business_process.channel</field>
        <field name="arch" type="xml">
            <form string="IO Channel">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Channel name"/>
                        </h1>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="process_io_channel_tree">
        <field name="name">business_process_io_channel.tree</field>
        <field name="model">risk_management.business_process.channel</field>
        <field name="arch" type="xml">
            <tree string="IO Channel">
                <field name="name"/>
                <field name="data_ids" widget="many2many_tags"/>
            </tree>
        </field>
    </record>

    <!--actions-->
    <record model="ir.actions.act_window" id="act_business_process_io_channel">
        <field name="name">Business process i/o channel</field>
        <field name="res_model">risk_management.business_process.channel</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Here, you can create new io channels
            </p>
        </field>
    </record>

    <menuitem id="menu_business_process_io_channels" name="Process I/O Channels" parent="config_menu"
              action="act_business_process_io_channel" sequence="50"/>

    <!-- BUSINESS PROCESS TASK -->

    <!-- views-->

    <record model="ir.ui.view" id="process_task_all">
        <field name="name">process_task.tree</field>
        <field name="model">risk_management.business_process.task</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="business_process_id"/>
                <field name="frequency"/>
                <field name="owner_id"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="process_task_search">
        <field name="name">process_task.search</field>
        <field name="model">risk_management.business_process.task</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" string="Tasks"/>
                <field name="owner_id"/>
                <field name="description"/>
                <field name="business_process_id"/>
                <filter name="my_tasks" string="My tasks"
                        domain="['|', ('owner_id', '=', uid), ('business_process_id.responsible_id', '=', uid)]"/>
                <filter string="Unassigned" name="unassigned" domain="[('owner_id', '=', False)]"/>
                <filter string="Daily Task" name="daily" domain="[('frequency', '=', 'daily')]"/>
                <filter string="Weekly Task" name="weekly" domain="[('frequency', '=', 'weekly')]"/>
                <filter string="Monthly Task" name="monthly" domain="[('frequency', '=', 'monthly')]"/>
                <filter string="Annual Task" name="annual" domain="[('frequency', '=', 'annually')]"/>
                <group expand="0" string="Group By">
                    <filter string="Process" name="process" context="{'group_by': 'business_process_id'}"/>
                    <filter string="Owner" name="owner" context="{'group_by': 'owner_id'}"/>
                    <filter string="Manager" name="manager" context="{'group_by': 'manager_id'}"/>
                </group>

            </search>
        </field>
    </record>

    <record model="ir.ui.view" id="process_task_form">
        <field name="name">business_process.task.form</field>
        <field name="model">risk_management.business_process.task</field>
        <field name="arch" type="xml">
            <form>
                <header string="Task">
                    <button name="action_assign_to_me" string="Assign to Me" type="object" class="oe_highlight"
                            attrs="{'invisible' : [('owner_id', '!=', False)]}"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1 class="o_row">
                            <field name="name" placeholder="Task Title..."/>
                        </h1>
                    </div>
                    <group>
                        <field name="business_process_id"/>
                        <field name="owner_id"/>
                    </group>
                    <group>
                        <field name="sequence" groups="base.group_no_one"/>
                        <field name="frequency"/>
                        <label for="manager_id" class="oe_read_only"/>
                        <field name="manager_id" class="oe_read_only" nolabel="1"/>
                    </group>
                    <group>
                        <field name="description"/>
                    </group>

                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.actions.act_window" id="process_task_all">
        <field name="name">Tasks</field>
        <field name="res_model">risk_management.business_process.task</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{
            'search_default_my_tasks': 1,
            }
        </field>
        <field name="search_view_id" ref="process_task_search"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Here, you can create new tasks
            </p>
        </field>
    </record>

    <menuitem id="menu_business_process_task" name="Process Tasks" parent="config_menu"
              action="process_task_all" sequence="40"/>


    <!-- actions-->
    <record model="ir.actions.act_window" id="act_business_process_2_process_task_all">
        <field name="name">Tasks</field>
        <field name="res_model">risk_management.business_process.task</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{
            'default_business_process_id': active_id,
            'search_default_business_process_id': [active_id],
            }
        </field>
        <field name="search_view_id" ref="process_task_search"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Here, you can create new tasks
            </p>
        </field>
    </record>

    <!-- BUSINESS PROCESS METHOD-->
    <!-- views-->
    <record model="ir.ui.view" id="process_method_all">
        <field name="name">process_method.tree</field>
        <field name="model">risk_management.business_process.method</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="business_process_id" invisible="context.get('search_default_business_process_id', False)"/>
                <field name="author_name"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="process_method_search">
        <field name="name">process_method.search</field>
        <field name="model">risk_management.business_process.method</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" string="Methods"/>
                <field name="business_process_id" string="Process"/>
                <field name="author_name"/>
                <filter name="my_methods" string="My Methods"
                        domain="[('business_process_id.responsible_id', '=', uid)]"/>
                <group expand="0" string="Group By">
                    <filter string="Business Process" name="process" context="{'group_by': 'business_process_id'}"/>
                    <filter string="Origin" name="origin" context="{'group_by': 'author_name'}"/>
                </group>
            </search>
        </field>
    </record>

    <record model="ir.ui.view" id="process_method_form">
        <field name="name">process_method.form</field>
        <field name="model">risk_management.business_process.method</field>
        <field name="arch" type="xml">
            <form string="Method / Business rule ">
                <sheet>
                    <div class="oe_button_box" name="button_box" groups="base.group_user">
                        <button class="oe_stat_button" name="attachment_tree_view" type="object" icon="fa-files-o">
                            <field string="Documents" name="doc_count" widget="statinfo"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="Method name"/>
                        </h1>
                    </div>
                    <group>
                        <field name="business_process_id"
                               context="{'form_view_ref': 'risk_management.business_process_form_view'}"/>
                        <field name="output_ref_id"/>
                        <label for="author_name" class="oe_read_only"/>
                        <field name="author_name" string="Origin" class="oe_read_only" nolabel="1"/>
                    </group>
                    <notebook>
                        <page name="content_page" string="Details">
                            <field name="content" type="html"/>
                            <div class="oe_clear"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- actions-->
    <record model="ir.actions.act_window" id="act_business_process_2_process_method_all">
        <field name="name">Methods</field>
        <field name="res_model">risk_management.business_process.method</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_business_process_id': active_id, 'search_default_business_process_id':
            [active_id],
            }
        </field>
        <field name="search_view_id" ref="process_method_search"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Here, you can create new process methods
            </p>
        </field>
    </record>

    <record model="ir.actions.act_window.view" id="action_process_method_all_list">
        <field name="act_window_id" ref="act_business_process_2_process_method_all"/>
        <field name="view_id" ref="process_method_all"/>
        <field name="view_mode">tree</field>
        <field name="sequence">10</field>
    </record>

    <record model="ir.actions.act_window.view" id="action_process_method_all_form">
        <field name="act_window_id" ref="act_business_process_2_process_method_all"/>
        <field name="view_id" ref="process_method_form"/>
        <field name="view_mode">form</field>
        <field name="sequence">20</field>
    </record>

    <!-- BUSINESS RISK EVALUATION -->

    <record model="ir.ui.view" id="view_business_risk_evaluation_list">
        <field name="name">business_risk.evaluation.tree</field>
        <field name="model">risk_management.business_risk.evaluation</field>
        <field name="arch" type="xml">
            <tree create="false"
                  decoration-danger="(risk_type == 'T' and value &gt; threshold_value) or (risk_type == 'O' and value &lt; threshold_value)"
                  decoration-success="(risk_type == 'T' and value &lt; threshold_value) or (risk_type == 'O' and value &gt; threshold_value)"
                  decoration-it="is_obsolete"
            >
                <field name="eval_date"/>
                <field name="create_uid"/>
                <field name="business_risk_id" invisible="context.get('default_business_risk_id', False)"/>
                <field name="risk_type" invisible="context.get('default_business_risk_id', False)"/>
                <field name="detectability"/>
                <field name="severity"/>
                <field name="occurrence"/>
                <field name="threshold_value" invisible="1"/>
                <field name="is_obsolete" invisible="1"/>
                <field name="value"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_business_risk_eval_graph">
        <field name="name">business_risk.evaluation.graph</field>
        <field name="model">risk_management.business_risk.evaluation</field>
        <field name="arch" type="xml">
            <graph string="Timeline" type="line">
                <field name="eval_date"/>
                <field name="business_risk_id"/>
                <field name="value" type="measure"/>
                <field name="threshold_value" type="measure"/>
            </graph>
        </field>
    </record>

    <record model="ir.ui.view" id="view_risk_eval_edit_form">
        <field name="name">business_risk.evaluation.edit</field>
        <field name="model">risk_management.business_risk.evaluation</field>
        <field name="arch" type="xml">
            <form string="Risk evaluation">
                <group>
                    <field name="business_risk_id" readonly="1"/>
                    <field name="detectability" readonly="1"/>
                    <field name="occurrence" readonly="1"/>
                    <field name="severity" readonly="1"/>
                </group>
                <group>
                    <group>
                        <field name="review_date" attrs="{'readonly': [('is_valid', '=', True)]}"/>
                        <field name="is_valid" groups="risk_management.group_manager"/>
                    </group>
                    <group>
                        <field name="threshold_value"/>
                        <field name="value"/>
                    </group>
                </group>
                <notebook>
                    <page>
                        <field name="comment" type="html"/>
                        <div class="oe_clear"/>
                    </page>
                </notebook>
            </form>
        </field>
    </record>

    <record model="ir.actions.act_window" id="act_business_risk_evaluation">
        <field name="name">Business Risk Evaluation</field>
        <field name="res_model">risk_management.business_risk.evaluation</field>
        <field name="view_mode">tree,graph,form</field>
    </record>

    <!-- BUSINESS RISKS -->

    <record id="view_business_risk_search" model="ir.ui.view">
        <field name="name">business_risk.search</field>
        <field name="model">risk_management.business_risk</field>
        <field name="arch" type="xml">
            <search>
                <field name="risk_info_id"/>
                <field name="risk_info_description"/>
                <field name="risk_info_cause"/>
                <field name="risk_info_consequence"/>
                <filter name="evaluated" string="Evaluated" domain="[('latest_level_value', '!=', 0)]"/>
                <separator/>
                <filter name="acceptable" string="Acceptable" domain="[('status', '=', 'A')]"/>
                <filter name="not_acceptable" string="Unacceptable" domain="[('status', '=', 'N')]"/>
                <separator/>
                <filter name="threats" string="ThreatS" domain="[('risk_type', '=', 'T')]"/>
                <filter name="opportunities" string="Opportunities" domain="[('risk_type', '=', 'O')]"/>
                <separator/>
                <filter name="my_reported" string="Reported by me" domain="[('reported_by', '=', uid)]"/>
                <filter name="my_assigned" string="Assigned to me" domain="[('owner', '=', uid)]"/>
                <filter name="my_followed" string="Followed by Me" domain="[('message_is_follower','=',True)]"/>
                <filter name="unassigned" string="Unassigned" domain="[('owner', '=', False)]"/>
                <filter name="unconfirmed" string="waiting for confirmation" domain="[('is_confirmed', '=', False)]"/>
                <separator/>
                <filter name="inactive" string="Latent" domain="[('active', '=', False)]"
                        groups="risk_management.group_risk_manager"/>
                <separator/>
                <filter name="unevaluated" string="Un-evaluated" domain="[('latest_level_value', '=', 0)]"/>
                <filter name="untreated" string="Untreated"
                        domain="[('latest_level_value', '!=', False), ('treatment_task_id.child_ids', '=', False)]"/>
                <group expand="0" string="Group By">
                    <filter string="Category" name="Category" context="{'group_by': 'risk_info_category'}"/>
                    <filter string="Stage" name="Stage" context="{'group_by': 'stage'}"/>
                    <filter string="Type" name="Type" context="{'group_by':'risk_type'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="view_business_risk_tree" model="ir.ui.view">
        <field name="name">business_risk.list</field>
        <field name="model">risk_management.business_risk</field>
        <field name="arch" type="xml">
            <tree decoration-muted="active==False or is_confirmed==False"
                  decoration-info="is_confirmed==True and status=='U'"
                  decoration-danger="status=='N'"
                  decoration-bf="status=='N'" decoration-success="status=='A'"
            >
                <field name="priority"/>
                <field name="name"/>
                <field name="risk_info_id"/>
                <field name="ref_asset_id"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="report_date"/>
                <field name="stage"/>
                <field name="status" invisible="1"/>
                <field name="active" invisible="1"/>
                <field name="is_confirmed" invisible="1"/>
                <field name="state" invisible="1"/>

            </tree>
        </field>
    </record>

    <record id="view_business_risk_kanban" model="ir.ui.view">
        <field name="name">business_risk.kanban</field>
        <field name="model">risk_management.business_risk</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage" class="o_kanban_small_column o_kanban_project_tasks"
                    group_create="false" group_delete="false" group_edit="false" create="false">
                <field name="name"/>
                <field name="ref_asset_id"/>
                <field name="risk_info_id"/>
                <field name="risk_type"/>
                <field name="report_date"/>
                <field name="review_date"/>
                <field name="owner"/>
                <field name="status"/>
                <field name="activity_ids"/>
                <field name="stage"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <t t-if="record.risk_type.raw_value=='O'">
                                            <strong>
                                                <i class="text-success fa fa-leaf"/>
                                                <t t-raw="record.risk_type.value"/>
                                            </strong>
                                            <br/>
                                        </t>
                                        <t t-else="record.risk_type.raw_value=='T'">
                                            <strong>
                                                <i class="text-danger fa fa-exclamation-triangle"/>
                                                <t t-raw="record.risk_type.value"/>
                                            </strong>
                                            <br/>
                                        </t>
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                            <field name="ref_asset_id"/>
                                        </strong>
                                        <br/>
                                        <small class="o_kanban_record_subtitle text-muted">
                                            <t t-if="record.review_date.raw_value and record.review_date.raw_value lt (new Date())"
                                               t-set="red">oe_kanban_text_red
                                            </t>
                                            <span t-attf-class="#{red || ''}">
                                                <i>
                                                    <field name="review_date"/>
                                                </i>
                                            </span>
                                        </small>
                                    </div>
                                    <div class="o_dropdown_kanban dropdown" groups="base.group_user">
                                        <a class="dropdown-toggle btn" data-toggle="dropdown" href="#">
                                            <span class="fa fa-ellipsis-v" aria-hidden="true"/>
                                        </a>
                                        <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                            <li t-if="widget.editable">
                                                <a type="edit">Edit Risk</a>
                                            </li>
                                            <li t-if="widget.deletable">
                                                <a type="delete">Delete</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <field name="risk_info_id"/>
                                    <br/>
                                    <field name="status" widget="label_selection"
                                           options="{'classes': {'U': 'default', 'A': 'success', 'N': 'danger'}}"/>

                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="activity_ids" widget="kanban_activity"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <img t-att-src="kanban_image('res.users', 'image_small', record.owner.raw_value)"
                                             t-att-title="record.owner.value" width="24" height="24"
                                             class="oe_kanban_avatar"/>
                                    </div>
                                </div>
                            </div>
                            <div class="oe_clear"/>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_business_risk_calendar" model="ir.ui.view">
        <field name="name">business_risk.calendar</field>
        <field name="model">risk_management.business_risk</field>
        <field eval="2" name="priority"/>
        <field name="arch" type="xml">
            <calendar date_start="review_date" string="Risks" mode="month" color="owner">
                <field name="name"/>
            </calendar>
        </field>
    </record>

    <record id="view_tree_business_risk_activity" model="ir.ui.view">
        <field name="name">business_risk.tree.activity</field>
        <field name="model">risk_management.business_risk</field>
        <field name="arch" type="xml">
            <tree string="Risk activities" default_order="activity_date_deadline"
                  decoration-danger="activity_date_deadline != False and activity_date_deadline &lt; current_date">
                <field name="name"/>
                <field name="ref_asset_id"/>
                <field name="activity_date_deadline"/>
                <field name="activity_type_id"/>
                <field name="activity_summary"/>
                <field name="stage"/>
            </tree>
        </field>
    </record>

    <record id="view_business_risk_edit" model="ir.ui.view">
        <field name="name">business_risk.form</field>
        <field name="model">risk_management.business_risk</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="assign_to_me" string="Assign to Me" type="object" class="oe_highlight oe_read_only"
                            attrs="{'invisible' : ['|', ('status', '!=', 'N'), ('owner', '!=', False)]}"
                            groups="risk_management.group_risk_manager"/>
                    <button name="%(risk_management.act_set_business_risk_threshold_wizard)d"
                            type="action"
                            class="btn-primary oe_read_only" groups="risk_management.group_manager"
                            string="Set Threshold"
                            attrs="{'invisible': [('is_confirmed', '=', False)]}"
                    />
                    <button name="%(risk_management.act_eval_business_risk_wizard)d"
                            type="action"
                            class="btn-danger oe_read_only" groups="risk_management.group_risk_manager"
                            string="Evaluation"
                            attrs="{'invisible': [('is_confirmed', '=', False)]}"
                    />
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="get_treatments_view"
                                type="object"
                                class="oe_stat_button oe_read_only"
                                icon="fa-tasks"
                                attrs="{'invisible': ['|', '|', ('owner', '=', False), ('stage', 'not in', ['Eval. Done', 'Treatment', 'Done']), ('treatment_task_id', '=', False)]}"
                        >
                            <field string="Treatment tasks" name="treatment_task_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" type="object" name="toggle_active" icon="fa-archive"
                                attrs="{'invisible': [('stage', 'in', ['New', 'Identification'])]}"
                                groups="risk_management.group_risk_manager"
                        >
                            <field name="active" widget="boolean_button"
                                   options='{"terminology": "archive"}'/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <field name="treatment_task_id" invisible="1"/>
                        <field name="status" widget="label_selection"
                               options="{'classes': {'U': 'default', 'A': 'success', 'N': 'danger'}}"
                               class="oe_read_only"
                        />
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <group>
                        <field name="risk_info_id"/>
                        <field name="company_id" groups="base.group_multi_company"/>
                        <field name="ref_asset_id"/>
                    </group>
                    <group>
                        <group>
                            <field name="risk_type"/>
                             <field name="owner"/>
                        </group>
                        <group>
                            <field name="is_confirmed" groups="risk_management.group_risk_manager"/>
                            <field name="review_date"/>
                        </group>
                    </group>
                    <group class="oe_read_only">
                        <group>
                            <field name="max_level_value" invisible="1"/>
                            <field name="threshold_value" widget="progressbar"
                                   options="{'current_value': 'threshold_value', 'ref_value': 'threshold_value', 'max_value': 'max_level_value'}"/>
                            <field name="latest_level_value" widget="progressbar"
                                   options="{'current_value': 'latest_level_value', 'ref_value': 'threshold_value', 'max_value': 'max_level_value'}"/>
                            <field name="last_evaluator_id"/>
                        </group>
                        <group>
                            <field name="reported_by"/>
                            <field name="report_date"/>
                            <field name="stage" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="info_page" string="Risk details">
                            <group>
                                <field name="risk_info_name"/>
                                <field name="risk_info_category"/>
                                <field name="risk_info_subcategory"
                                       attrs="{'invisible': [('risk_info_id', '=', False)]}"/>
                            </group>
                            <group>
                                <field name="risk_info_description"/>
                                <field name="risk_info_cause"/>
                                <field name="risk_info_consequence"/>
                            </group>
                        </page>
                        <page name="eval_timeline" string="Timeline"
                              attrs="{'invisible': [('evaluation_ids', '=', False)]}">
                            <field name="evaluation_ids" context="{'default_business_risk_id': active_id}"/>
                        </page>
                        <page name="comment_page" string="Comments">
                            <field name="comment"/>
                            <div class="oe_clear"/>
                        </page>
                        <page name="help_page" string="Treatment guides" class="oe_read_only">
                            <group>
                                <button
                                        name="%(risk_management.act_edit_risk_info_help)d"
                                        type="action"
                                        string="Edit..."
                                        class="btn-primary oe_right oe_link"
                                        context="{'default_risk_info_id': risk_info_id}"
                                >
                                </button>
                            </group>
                            <group>
                                <field name="risk_info_control"/>
                            </group>
                            <group>
                                <field name="risk_info_action"/>
                            </group>
                            <group>
                                <field name="risk_info_dso"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record model="ir.actions.act_window" id="act_business_risk_register">
        <field name="name">Risk Register</field>
        <field name="res_model">risk_management.business_risk</field>
        <field name="view_mode">tree,form,kanban,calendar</field>
        <field name="search_view_id" ref="view_business_risk_search"/>
        <field name="context" eval="{'search_default_evaluated':1}"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent">
                There is no risk in this risk register at the moment.
            </p>
        </field>
    </record>

    <record id="act_business_risk_activity" model="ir.actions.act_window">
        <field name="name">Risk activities</field>
        <field name="res_model">risk_management.business_risk</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,kanban,calendar</field>
        <field name="view_id" ref="view_tree_business_risk_activity"/>
        <field name="context">{'search_default_activities_my':1}</field>
        <field name="domain">[('activity_date_deadline', '!=', False)]</field>
        <field name="help" type="html">
            <p>
                Currently there are not any activity scheduled.
            </p>
        </field>
    </record>


    <menuitem id="menu_risk_register" name="Risk Register" parent="risk_menu" action="act_business_risk_register"/>
    <menuitem action="act_business_risk_activity" id="menu_business_risk_activity" parent="risk_menu" sequence="40"/>

    <!-- BUSINESS PROCESS-->
    <!-- actions-->
    <record model="ir.actions.act_window" id="business_process_list_action">
        <field name="name">Processes</field>
        <field name="res_model">risk_management.business_process</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">Create your first Process!</p>
        </field>
    </record>

    <!-- views-->
    <record model="ir.ui.view" id="business_process_kanban_view">
        <field name="name">process.kanban</field>
        <field name="model">risk_management.business_process</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" default_group_by="process_type">
                <field name="responsible_id" string="Process Manager"/>
                <field name="process_type"/>
                <field name="description"/>
                <field name="color"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="o_kanban_record_top">
                                            <div class="o_kanban_record_headings">
                                                <strong class="o_kanban_record_title">
                                                    <field name="name" string="Process Name"/>
                                                </strong>
                                            </div>
                                            <div class="o_dropdown_kanban dropdown" groups="base.group_user">
                                                <a class="dropdown-toggle btn" data-toggle="dropdown" href="#">
                                                    <span class="fa fa-ellipsis-v" aria-hidden="true"/>
                                                </a>
                                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                                    <li t-if="widget.editable">
                                                        <a type="edit">Edit Business Process</a>
                                                    </li>
                                                    <li t-if="widget.deletable">
                                                        <a type="delete">Delete</a>
                                                    </li>
                                                    <li class="divider"></li>
                                                    <li class="dropdown-header">Process's Colour</li>
                                                    <li>
                                                        <ul class="oe_kanban_colorpicker" data-field="color"/>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-8">
                                        <field name="company_id" string="Company" groups="base.group_multi_company"/>
                                    </div>
                                    <div class="col-xs-4">
                                        <div class="oe_kanban_bottom_right">
                                            <img t-att-src="kanban_image('res.users', 'image_small', record.responsible_id.raw_value)"
                                                 t-att-title="record.responsible_id.value" width="24" height="24"
                                                 class="oe_kanban_avatar pull-right"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record model="ir.ui.view" id="business_process_form_view">
        <field name="name">business_process.form</field>
        <field name="model">risk_management.business_process</field>
        <field name="arch" type="xml">
            <form string="Process">
                <header>
                    <button name="add_partner_input"
                            type="object"
                            string="Add partner input"
                            class="btn-danger oe_read_only"
                            groups="risk_management.group_manager"
                    />
                </header>
                <sheet string="Process">
                    <field name="analytic_account_id" invisible="1" required="0"/>
                    <div class="oe_button_box" name="button_box">
                        <button name="%(risk_management.act_business_process_2_process_method_all)d"
                                type="action"
                                class="oe_stat_button"
                                icon="fa-files-o">
                            <field string="Procedures" name="method_count" widget="statinfo"/>
                        </button>
                        <button name="%(risk_management.act_business_process_2_process_task_all)d"
                                type="action"
                                class="oe_stat_button"
                                icon="fa-tasks">
                            <field string="Tasks" name="task_count" widget="statinfo"/>
                        </button>
                        <button name="%(risk_management.act_business_risk_register)d"
                                type="action"
                                class="oe_stat_button"
                                icon="fa-exclamation-circle"
                        >
                            <field string="Risks" name="risk_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" type="object" name="toggle_active" icon="fa-archive"
                                groups="risk_management.group_manager">
                            <field name="active" widget="boolean_button"
                                   options='{"terminology": "archive"}'/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <label for="name" string="Name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="Process name"/>
                        </h1>
                    </div>
                    <group>
                        <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                        <field name="process_type"/>
                        <field name="responsible_id"/>
                        <field name="module" options="{'no_open': True}"/>
                    </group>
                    <notebook>
                        <page name="description_page" string="Description">
                            <field name="description" type="html"/>
                            <div class="oe_clear"/>
                        </page>
                        <page string="Input" name="input_page">
                            <field name="input_data_ids"
                                   context="{'tree_view_ref': 'risk_management.process_input_data_list'}"/>
                        </page>
                        <page string="Output" name="output_page">
                            <field name="output_data_ids"
                                   context="{ 'tree_view_ref':'risk_management.process_output_data_list', 'default_business_process_id': active_id}"/>
                        </page>
                        <page name="extra" string="Extra info">
                            <group>
                                <field name="visibility"/>
                                <field name="user_ids" widget="many2many_tags"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="business_process_list_view">
        <field name="name">process.tree</field>
        <field name="model">risk_management.business_process</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="responsible_id"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="module"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="business_process_search_view">
        <field name="name">process.search</field>
        <field name="model">risk_management.business_process</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="description"/>
                <field name="module"/>
                <filter name="Management" string="Management" domain="[('process_type', '=', 'M')]"/>
                <filter name="Operation" string="Operations" domain="[('process_type', '=', 'O')]"/>
                <filter name="Support" string="Support" domain="[('process_type', '=', 'S')]"/>
                <separator/>
                <filter name="Inactive" string="Inactive" domain="[('active', '=', False)]"/>
                <group expand="0" string="Group By">
                    <filter string="Type" name="Type" context="{'group_by':'process_type'}"/>
                    <filter string="Company" name="Company" context="{'group_by': 'company_id'}"
                            groups="base.group_multi_company"/>
                </group>
            </search>
        </field>
    </record>

    <!-- menu -->
    <menuitem id="menu_business_process_list" name="Processes" parent="config_menu"
              action="business_process_list_action" sequence="30"/>


    <!-- PROJECT TASK -->
    <!-- views -->

    <record id="view_task_form2" model="ir.ui.view">
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <field name="project_id" position="after">
                <field name="target_criterium"
                       invisible="not context.get('default_target_criterium', False)"
                />
            </field>
        </field>
    </record>

    <record id="view_task_search_form" model="ir.ui.view">
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_search_form"/>
        <field name="arch" type="xml">
            <field name="project_id" position="after">
                <field name="parent_id"/>
            </field>
        </field>
    </record>


    <!--    RISK INFO-->

    <record id="view_risk_search" model="ir.ui.view">
        <field name="name">risk_info.search</field>
        <field name="model">risk_management.risk.info</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="risk_category_id"/>
                <field name="subcategory"/>
                <field name="description"/>
                <field name="cause"/>
                <field name="consequence"/>
            </search>
        </field>
    </record>

    <record model="ir.actions.act_window" id="risk_management.act_risk_category_2_risks_all">
        <field name="name">Risks</field>
        <field name="res_model">risk_management.risk.info</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_risk_category_id': active_id, 'search_default_risk_category_id': [active_id],
            }
        </field>
        <field name="search_view_id" ref="view_risk_search"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Here, you can create new Risks
            </p>
        </field>
    </record>

    <record id="act_risk_category_list" model="ir.actions.act_window">
        <field name="name">Risks Database</field>
        <field name="res_model">risk_management.risk.category</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Here, you can create new Risk Category
            </p>
        </field>
    </record>

    <record id="view_risk_list" model="ir.ui.view">
        <field name="name">risk_info.list</field>
        <field name="model">risk_management.risk.info</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="subcategory"/>
            </tree>
        </field>
    </record>

    <record id="view_risk_form" model="ir.ui.view">
        <field name="name">risk_info.form</field>
        <field name="model">risk_management.risk.info</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_right oe_button_box oe_read_only" name="buttons">
                        <button name="%(risk_management.act_business_risk_register)d"
                                type="action"
                                class="oe_stat_button"
                                icon="fa-hashtag"
                                context="{'search_default_risk_info_id':[active_id]}"
                        >
                            <field string="Occurrences" name="occurrences" widget="statinfo"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h6>
                            <field name="name" placeholder="Risk Title" widget="text"/>
                        </h6>
                    </div>
                    <group name="classification" string="Classification">
                        <field name="risk_category_id"/>
                        <field name="subcategory"/>
                    </group>
                    <notebook>
                        <page name="description_page" string="Description">
                            <field name="description" type="html"/>
                            <div class="oe_clear"/>
                        </page>
                        <page name="cause_page" string="Cause">
                            <field name="cause" type="html"/>
                            <div class="oe_clear"/>
                        </page>
                        <page name="consequence_page" string="Consequence">
                            <field name="consequence" type="html"/>
                            <div class="oe_clear"/>
                        </page>
                        <page name="help" string="Help">
                            <group>
                                <field name="control"/>
                                <field name="action"/>
                                <field name="dso_help"/>
                            </group>
                        </page>
                    </notebook>

                </sheet>
            </form>
        </field>
    </record>

    <record id="view_risk_category_list" model="ir.ui.view">
        <field name="name">risk_category.list</field>
        <field name="model">risk_management.risk.category</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="risk_count"/>
            </tree>
        </field>
    </record>

    <record id="view_risk_category_form" model="ir.ui.view">
        <field name="name">risk_category.form</field>
        <field name="model">risk_management.risk.category</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_left oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <div class="oe_right oe_button_box" name="buttons">
                        <button name="%(risk_management.act_risk_category_2_risks_all)d"
                                type="action"
                                class="oe_stat_button"
                                icon="fa-files-o">
                            <field string="Risks" name="risk_count" widget="statinfo"/>
                        </button>
                    </div>
                </sheet>
            </form>
        </field>

    </record>

    <menuitem id="menu_risk_category" parent="config_menu" sequence="10" action="act_risk_category_list"/>

    <!-- project form-->
        <record model="ir.ui.view" id="project_form">
            <field name="name">project.project.form</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@name='button_box']/button[2]" position="after">
                    <button class="oe_stat_button" type="action"
                            name="%(act_business_risk_register)d"
                            icon="fa-exclamation-circle"
                    >
                        <field string="Risks" name="risk_count" widget="statinfo"/>
                    </button>
                </xpath>
            </field>
        </record>

    <data noupdate="1">
        <function model="risk_management.settings" name="set_subtask_project"/>
    </data>

</odoo>